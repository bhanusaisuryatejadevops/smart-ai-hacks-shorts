name: Test Single YouTube Short Upload

on:
  workflow_dispatch:

jobs:
  test-short:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run pipeline in Docker (full Ubuntu)
        run: |
          docker run --rm -v ${{ github.workspace }}:/app -w /app ubuntu:22.04 bash -c "
            apt-get update && apt-get install -y \
              python3 python3-pip python3-venv ffmpeg imagemagick \
              libsm6 libxext6 git && \
            python3 -m pip install --upgrade pip && \
            pip install git+https://github.com/Zulko/moviepy.git imageio imageio-ffmpeg decorator numpy Pillow tqdm \
            openai google-auth google-auth-oauthlib google-api-python-client requests python-dotenv && \
            python3 run_pipeline.py
          "
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
          CHANNEL_TITLE: ${{ secrets.CHANNEL_TITLE }}
